# 用户登录与访问权限控制设计

## 前端界面显示控制
### 用户管理模块
根据本地credentials判断是否为管理员用户 => 显示/不显示用户管理模块

### 导航栏模块
+ 功能页面显示导航栏;welcome/login不现实导航栏
+ 观察路由事件 => 动态控制导航栏的显示与隐藏

## 前端本地控制（进入页面前）-- 路由守卫
### welcome/login页面
1. 是否本地存在credentials（包含token及用户信息）（是否属于已登录状态） => 跳转至首页/Next
2. 发送请求至后端 => 后端确认是否首次使用系统（系统有/无任何用户）=> welcome/login页面

### 功能页面
是否本地存在credentials（是否属于已登录状态） => 进入功能页面/跳转至login

### Admin页面
1. 是否本地存在credentials（是否属于已登录状态） =>Next/跳转至login
2. 本地credentials是否显示用户为管理员类型 => 进入Admin页面/跳转至404页面

## 前端向后端请求验证（进入页面后）-- http拦截器
### 请求发送处理
每个heep请求在请求头带上本地credentials中的token

### 请求响应处理
1. 返回401状态码 => 删除本地credentials（如果有）；跳转至login
2. 否则，不做特殊处理

## 后端登录与鉴权
### jwt、session、cookie、storage
无状态

### 登录逻辑
后端接收到前端发送的用户信息 => 将前端发送的用户信息（密码需在后端做hash处理）与数据库用户信息比对 => 是否匹配 => 若匹配token签入（包括存入用户信息、有效期等），token存入缓存。若不匹配，返回incorrect/权限到期

### 创建用户鉴权
1. 创建的是系统第一个用户

后端接收到前端发送的创建的用户信息 => 请求头是否没有携带token或是否创建的用户类型为管理员 => Next/返回401
判断是否为首次使用系统 => 创建用户/返回401

2. 创建的不是系统第一个用户

  + 后端接收到前端发送的创建的用户信息 => 请求头携带token => 判断token本身是否过期 =>返回401/Next
  + 解码token => 解码后拿到用户信息 => 用户是否为管理员且与缓存token比对 => Next/返回401
  + 创建用户 => 创建用户是否成功 => 返回success/Next
  + 是否已存在同名用户 => 返回已存在同名用户提示/返回fail

### 修改用户信息鉴权

### 删除用户鉴权

### 一般api鉴权

### websocket鉴权

### 涉及到修改头像



